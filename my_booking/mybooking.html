<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>RedPlanet &mdash; A Onepage Hotel HTML Bootstrap Website Template by Colorlib </title>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="icon" href="../images/favicon.ico"  type="image/png">
    <link rel="stylesheet" type="text/css" href="//fonts.googleapis.com/css?family=|Roboto+Sans:400,700|Playfair+Display:400,700">

    <link rel="stylesheet" href="../css/bootstrap.min.css">
    <link rel="stylesheet" href="../css/animate.css">
    <link rel="stylesheet" href="../css/owl.carousel.min.css">
    <link rel="stylesheet" href="../css/aos.css">
    <link rel="stylesheet" href="../css/bootstrap-datepicker.css">
    <link rel="stylesheet" href="../css/jquery.timepicker.css">
    <link rel="stylesheet" href="../css/fancybox.min.css">
    
    <link rel="stylesheet" href="fonts/ionicons/css/ionicons.min.css">
    <link rel="stylesheet" href="fonts/fontawesome/css/font-awesome.min.css">

    <!-- Theme Style -->
    <link rel="stylesheet" href="../css/style.css">
  </head>
  <body data-spy="scroll" data-target="#templateux-navbar" data-offset="200">

  <nav class="navbar navbar-expand-lg navbar-dark pb_navbar pb_scrolled-light scrolled awake" id="templateux-navbar">
    <div class="container">
      <img
      style="width: 5em"
      class="img-fluid m-1"
      src="../images/logo1.png"
    />
    <a class="navbar-brand" href="index.html"
    ><span class="text-warning">Hacienda Galea Resort</span><br>and Events Place</a
  >
      <div class="site-menu-toggle js-site-menu-toggle  ml-auto"  data-aos="fade" data-toggle="collapse" data-target="#templateux-navbar-nav" aria-controls="templateux-navbar-nav" aria-expanded="false" aria-label="Toggle navigation">
            <span></span>
            <span></span>
            <span></span>
          </div>
          <!-- END menu-toggle -->

      <div class="collapse navbar-collapse" id="templateux-navbar-nav">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="../index.html">Home</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="../rooms.html">Rooms</a>
          </li>
          <li class="nav-item">
            <a class="nav-link " href="../gallery.html">Gallery</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../aboutus.html">About</a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="../contact.html">Contact</a>
          </li>
          <li class="nav-item cta-btn ml-xl-2 ml-lg-2 ml-md-0 ml-sm-0 ml-0">
            <a class="nav-link" href="../myBooking.html" target="_blank"
              ><span class="pb_rounded-4 px-4 rounded">My Booking</span></a
            >
          </li>
        </ul>
      </div>
    </div>
  </nav>
  <!-- END nav -->
   <!-- END .block-2 -->  
    <!-- END section -->
    <!-- END section -->
    

    <section class="section contact-section " id="section-contact">
    <div class="container">
        <div class="row mx-auto w-75">
            <div claas="col-12">
              <div class="card shadow bg-muted">
                <div class="card-body">
                  <div class="row">
                    <div class="col-xl-6 col-lg-12">
                      <h4 class="text-info">Guest Information</h4>
                      <address class="m-t-5 m-b-5">
                        <h5 class="m-2">Name: <b id="guest_name"></b></h5>
                        <h5 class="m-2">Address: <b id="guest_address"></b></h5>
                        <h5 class="m-2">Phone: <b id="guest_contact"></b></h5>
                        <h5 class="m-2">E-mail: <b id="guest_email"></b></h5>
                      </address>
                    </div>
                    <div class="col-xl-6 col-lg-12">
                      <h4 class="text-success">Booking Information</h4>
                      <address class="m-t-5 m-b-5">
                        <h5 class="m-2">Check-In: <b id="checkin"></b></h5>
                        <h5 class="m-2">Check-Out: <b id="checkout"></b></h5>
                        <h5 class="m-2">
                          No. Night(s): <b id="num_nights"></b>
                        </h5>
                        <h5 class="m-2">Booking Status: <b id="status"></b></h5>
                      </address>
                    </div>
                    <div class="col-12">
                      <div class="d-flex justify-content-center">
                        <button
                          class="btn btn-primary mr-1"
                          data-toggle="modal"
                          data-target="#modal-sm"
                        >
                          <i class="fa fa-image"></i> UPLOAD BANK RECEIPT
                        </button>
                        <a
                          class="btn btn-primary ml-1 text-light"
                          href="../change_booking/select_date.html"
                        >
                          <i class="fa fa-undo"></i> CHANGE BOOKING
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-xl-12">
              <div class="card shadow bg-muted mt-2">
                <div class="card-body">
                  <h3 class="text-secondary">Room Details</h3>
                  <table id="rooms" class="table table-sm table-hover">
                    <thead>
                      <tr class="table-success">
                        <th>Availed Room</th>
                        <th>Amount</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="card shadow bg-muted mt-2">
                <div class="card-body">
                  <h3 class="text-secondary m-2">Upload Receipt History</h3>
                  <table id="upload_image" class="table table-sm table-hover">
                    <thead>
                      <tr class="table-info">
                        <th>Receipt ID</th>
                        <th>Upload Date</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
            <div class="col-12">
              <div class="card shadow bg-muted mt-2">
                <div class="card-body">
                  <h3 class="text-secondary m-2">Payment History</h3>
                  <table id="payment_history" class="table table-sm table-hover">
                    <thead>
                      <tr class="table-primary">
                        <th>Payment Amount</th>
                        <th>Payment Date</th>
                      </tr>
                    </thead>
                    <tbody></tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
    </div>
  </section>

  <div class="modal fade" id="modal-sm">
    <div class="modal-dialog modal-sm">
      <form id="upload_img_form" enctype="multipart/form-data">
        <div class="modal-content">
          <div class="modal-header bg-dark">
            <h4 class="modal-title text-light">Upload Receipt</h4>
            <button
              type="button"
              class="close text-light"
              data-dismiss="modal"
              aria-label="Close"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <input
              type="file"
              id="imgToUpload"
              class="imgToUpload form-control-file"
              accept="image/x-png,image/gif,image/jpeg"
              required
            />
          </div>
          <div class="modal-footer justify-content-between">
            <button type="submit" class="btn btn-primary" id="btn-submit">
              Save changes
            </button>
            <button
              type="button"
              class="btn btn-secondary"
              data-dismiss="modal"
            >
              Close
            </button>
          </div>
        </div>
      </form>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>

  <div class="modal fade" id="modal-image">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary">
          <h4 class="modal-title"></h4>
          <button
            type="button"
            class="close"
            data-dismiss="modal"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <img
            id="receipt_img"
            class="img-fluid"
            style="height: 700px; width: 100%; max-width: 500px"
          />
        </div>
        <div class="modal-footer justify-content-end">
          <button
            type="button"
            class="btn btn-secondary"
            data-dismiss="modal"
          >
            Close
          </button>
        </div>
      </div>
      <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
  </div>

  <footer class="section footer-section p-0">
    <div class="container">
      <div class="row mb-4"></div>
      <div class="row pt-5">
        <p class="col-md-8 text-left">
          Copyright &copy;
          <script>
            document.write(new Date().getFullYear());
          </script>
          All rights reserved | Hacienda Galea Resort
        </p>
        <p class="col-md-4 text-right social">
          <!-- <a href=""><span class="fa fa-tripadvisor"></span></a> -->
          <a href="https://www.facebook.com/haciendagaleabaliuag" target="_blank"><span class="fa fa-facebook"></span></a>
          <!-- <a href="#"><span class="fa fa-twitter"></span></a>
          <a href="#"><span class="fa fa-linkedin"></span></a>
          <a href="#"><span class="fa fa-vimeo"></span></a> -->
        </p>
      </div>
    </div>
  </footer>

  
    <!-- Modal -->
  
    
    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/jquery-migrate-3.0.1.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/owl.carousel.min.js"></script>
    <script src="../js/jquery.stellar.min.js"></script>
    <script src="../js/jquery.fancybox.min.js"></script>
    <script src="../js/jquery.easing.1.3.js"></script>
    
    
    
    <script src="../js/aos.js"></script>
    
    <script src="../js/bootstrap-datepicker.js"></script> 
    <script src="../js/jquery.timepicker.min.js"></script> 

    <script src="../js/main1.js"></script>
  </body>

  <script>
       $(document).ready(() => {
      let billing_id = sessionStorage.getItem("my_booking_billingid");
      let guest_id = sessionStorage.getItem("my_booking_guestid");
      if (guest_id == null || guest_id == undefined)
        window.location = "../my_booking.html";

    

      let reservation_id = 0;

      $.ajax({
        url: "../php_functions/my_booking/get_rooms.php",
        data: "guest_id=" + guest_id,
        type: "POST",
        success: function (response) {
          reservation_id = JSON.parse(response)[0].reservation_id;
          JSON.parse(response).map((e) => {
            $("#rooms > tbody:last-child").append(
              "<tr class='guest_room'><td>" +
                e.roomtype_name +
                "</td><td>PHP " +
                e.room_price +
                "</td></tr>"
            );
          });
        },
      });

      booking_status = (value) => {
        if (value == 0 || value == 1) {
          return "<span class='text-danger'>Pending</span>";
        } else {
          return "<span class='text-success'>Confirmed</span>";
        }
      };

      $.ajax({
        url: "../php_functions/my_booking/get_guest_details.php",
        data: "guest_id=" + guest_id,
        type: "POST",
        success: function (response) {
          JSON.parse(response).map((e) => {
            $("#guest_name").html(e.first_name + " " + e.last_name);
            $("#guest_address").html(
              e.addressline_1 + " " + e.city + " " + e.zipcode
            );
            $("#guest_contact").html(e.contact_number);
            $("#guest_email").html(e.email);
            $("#checkin").html(e.checkin_date);
            $("#checkout").html(e.checkout_date);
            $("#status").html(booking_status(e.status));
          });
        },
      });

      $.ajax({
        url: "../php_functions/my_booking/get_payment.php",
        data: "guest_id=" + guest_id,
        type: "POST",
        success: function (response) {
          JSON.parse(response).map((e) => {
            $("#payment_history > tbody:last-child").append(
              "<tr class='guest_room'><td>PHP " +
                e.payed_capital +
                "</td><td> " +
                moment(e.payment_date).format("YYYY-MM-DD hh:mm a") +
                "</td></tr>"
            );
          });
        },
      });

      let table_receipts = $("#upload_image").DataTable({
        paging: false,
        ordering: false,
        info: false,
        searching: false,
        bAutoWidth: false,
        responsive: true,
        autoWidth: false,
        ajax: {
          url: "../php_functions/my_booking/get_receipts.php",
          type: "POST",
          dataSrc: "",
          data: { guest_id: guest_id },
        },
        columns: [
          {
            data: "receipt_photo_id",
          },
          {
            data: "upload_date",
            render: function (data, type, full, meta) {
              let status = data;
              return moment(status).format("YYYY-MM-DD hh:mm a");
            },
          },
        ],
      });

      $("#upload_image tbody").on("click", "tr", async function () {
        //$("#guest_additional").dataTable().fnDestroy();
        $("#modal-image").modal("show");
        $("#receipt_img").attr(
          "src",
          "../admin/dist/img/bank_receipts/" +
            table_receipts.row(this).data().photo +
            ""
        );
      });

      uploadSuccess = () => {
        $("#modal-sm").modal("hide");
        $(".loading").remove();
        Swal.fire({
          icon: "success",
          title: "Bank Receipt Uploaded!",
        });

        $("#btn-submit").removeAttr("disabled", "disabled");
      };

      $("#modal-sm").on("hidden.bs.modal", function () {
        table_receipts.ajax.reload();
        $("#btn-submit").removeAttr("disabled", "disabled");
      });

      $("#upload_img_form").submit((e) => {
        e.preventDefault();
        $("#btn-submit").attr("disabled", "disabled");
        $("#btn-submit").append(
          '<div class="loading spinner-border text-light" style="width: 1em;height: 1em;"></div>'
        );
        var fd = new FormData();
        let upload_image = $("#imgToUpload").prop("files")[0];
        fd.append("file", upload_image);
        fd.append("reservation_id", reservation_id);
        $.ajax({
          url: "../php_functions/my_booking/upload_picture.php",
          type: "POST",
          cache: false,
          processData: false, // tell jQuery not to process the data
          contentType: false, // tell jQuery not to set contentType
          dataType: "script",
          data: fd,
          success: (res) => {
            uploadSuccess();
          },
        });
      });
    });
  </script>
</html>