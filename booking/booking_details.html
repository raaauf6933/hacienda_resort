<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Hacienda Galea Resort and Events Place | Booking Details</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="icon" href="../images/favicon.ico" type="image/png" />
    <link
      rel="stylesheet"
      type="text/css"
      href="//fonts.googleapis.com/css?family=|Roboto+Sans:400,700|Playfair+Display:400,700"
    />

    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/animate.css" />
    <link rel="stylesheet" href="../css/owl.carousel.min.css" />
    <link rel="stylesheet" href="../css/aos.css" />
    <link rel="stylesheet" href="../css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../css/jquery.timepicker.css" />
    <link rel="stylesheet" href="../css/fancybox.min.css" />

    <link rel="stylesheet" href="../fonts/ionicons/css/ionicons.min.css" />
    <link
      rel="stylesheet"
      href="../fonts/fontawesome/css/font-awesome.min.css"
    />

    <link rel="stylesheet" href="../css/breadcrumb.css" type="text/css" />

    <!-- Theme Style -->
    <link rel="stylesheet" href="../css/_custom.css" />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body data-spy="scroll" data-target="#templateux-navbar" data-offset="200">
    <nav
      class="navbar navbar-expand-lg navbar-dark pb_navbar pb_scrolled-light scrolled awake"
      id="templateux-navbar"
    >
      <div class="container">
        <img
          style="width: 4em"
          class="img-fluid m-1"
          src="../images/logo1.png"
        />
        <a class="navbar-brand" href="index.html"
          ><span class="text-warning">Hacienda Galea Resort</span><br />and
          Events Place</a
        >
        <div
          class="site-menu-toggle js-site-menu-toggle ml-auto"
          data-aos="fade"
          data-toggle="collapse"
          data-target="#templateux-navbar-nav"
          aria-controls="templateux-navbar-nav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span></span>
          <span></span>
          <span></span>
        </div>
        <!-- END menu-toggle -->

        <div class="collapse navbar-collapse" id="templateux-navbar-nav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../rooms.html">Rooms</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../gallery.html">Gallery</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../aboutus.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../contact.html">Contact</a>
            </li>
            <li class="nav-item cta-btn ml-xl-2 ml-lg-2 ml-md-0 ml-sm-0 ml-0">
              <a class="nav-link" href="../myBooking.html" target="_blank"
                ><span class="pb_rounded-4 px-4 rounded">My Booking</span></a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- END nav -->
    <!-- END .block-2 -->
    <!-- END section -->
    <!-- END section -->

    <section class="section contact-section" id="section-contact">
      <div class="container">
        <div class="bread">
          <div class="breadcrumb-pagination">
            <div class="completed">
              <span>1</span>
              <p>Select Dates</p>
            </div>
            <div class="completed">
              <span>2</span>
              <p>Rooms</p>
            </div>
            <div class="completed">
              <span>3</span>
              <p>Guest Detail</p>
            </div>
            <div class="todo active">
              <span>4</span>
              <p>Review</p>
            </div>
            <div class="todo">
              <span>5</span>
              <p>Confirmation</p>
            </div>
          </div>
        </div>
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-header">
                <h3>Review your booking</h3>
              </div>
              <div class="card-body p-0">
                <div class="row pb-5 p-5">
                  <div class="col-md-4">
                    <p class="font-weight-bold mb-4">Guest Information</p>
                    <p class="mb-1" id="guest_name">
                      John Doe, Mrs Emma Downson
                    </p>

                    <p class="mb-1" id="guest_address">Berlin, Germany</p>
                    <p class="mb-1" id="guest_contact">6781 45P</p>
                    <p class="mb-1" id="guest_email"></p>
                  </div>

                  <div class="col-md-4">
                    <p class="font-weight-bold mb-4">Booking Details</p>
                    <p class="mb-1">
                      <span class="text-muted">Check-in: </span>
                      <b id="check_in"></b>
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">Check-out: </span>
                      <b id="check_out"></b>
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">No. Night(s): </span>
                      <b id="nights"></b>
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">No. Guest: </span>
                      <b id="guest_num"></b>
                    </p>
                  </div>
                  <div class="col-md-4 text-right">
                    <p class="font-weight-bold mb-4">Resort Details</p>
                    <p class="mb-1">Hacienda Galea resort</p>
                    <p class="mb-1">
                      <span class="text-muted">VAT ID: </span> 10253642
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">Payment Type: </span> Root
                    </p>
                    <p class="mb-1">
                      <span class="text-muted">Name: </span> John Doe
                    </p>
                  </div>
                </div>

                <div class="row p-5">
                  <div class="col-md-12">
                    <table class="table" id="invoice">
                      <thead>
                        <tr>
                          <th
                            class="border-0 text-uppercase small font-weight-bold"
                          >
                            Availed Room
                          </th>
                          <th
                            class="border-0 text-uppercase small font-weight-bold"
                          >
                            Rate
                          </th>
                          <th
                            class="border-0 text-uppercase small font-weight-bold"
                          >
                            Night(s)
                          </th>
                          <th
                            class="border-0 text-uppercase small font-weight-bold"
                          >
                            Quantity
                          </th>
                          <th
                            class="border-0 text-uppercase small font-weight-bold"
                          >
                            Amount
                          </th>
                        </tr>
                      </thead>
                      <tbody id="#invoice"></tbody>
                      <tfoot>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>Vatable Sales</th>
                          <th id="vatable"></th>
                        </tr>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>VAT (12%)</th>
                          <th id="vat"></th>
                        </tr>
                        <tr>
                          <th></th>
                          <th></th>
                          <th></th>
                          <th>Sub Total</th>
                          <th id="sub_total"></th>
                        </tr>
                      </tfoot>
                    </table>
                  </div>
                </div>

                <div class="d-flex flex-row-reverse bg-dark text-white p-4">
                  <div class="py-3 px-5 text-right">
                    <div class="mb-2">Total Amount</div>
                    <div class="h2 font-weight-light" id="total_amount"></div>
                  </div>

                  <!-- <div class="py-3 px-5 text-right">
                      <div class="mb-2">Discount</div>
                      <div class="h2 font-weight-light">10%</div>
                    </div> -->

                  <div class="py-3 px-5 text-right">
                    <div class="mb-2">Downpayment Amount</div>
                    <div class="h2 font-weight-light" id="downpayment"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-12 mt-2">
            <div class="invoice-note">
              <div class="row">
                <div class="col-xl-6 col-lg-12">
                  <h4>HOW TO PAY ?</h4>
                  <p>
                    * Payment is available only for Bank Deposit <br />
                    * After Confirming, You will receive an Email w/ Booking
                    Number<br />
                    * Deposit your 50% Downpayment to bank, and upload your bank
                    receipt<br />
                    <a
                      class="text-primary"
                      href="https://haciendagalearesort.com/myBookings.html"
                      >(click here to find your booking using your booking
                      number and email)</a
                    ><br />
                    * Wait your booking status to be confirmed.
                  </p>
                </div>
                <div class="col-xl-6 col-lg-12">
                  <h4>POLICY CONDITIONS</h4>
                  <p>
                    * You need to pay your 50% downpayment before 24hours or<br />
                    the reservation will be voided<br />
                    * Payment is strictly 50% downpayment only<br />
                    to be the reservation will be confirmed<br />
                    * No refund.
                  </p>
                </div>
              </div>
            </div>
          </div>

          <div class="col-12 mt-2">
            <div class="invoice-footer">
              <button class="btn btn-primary btn-lg btn-block" id="confirm">
                CONFIRM
              </button>
              <!--  <p class="text-center m-b-5 f-w-600">
                  THANK YOU FOR YOUR BUSINESS
                </p>
                <p class="text-center">
                  <span class="m-r-10"
                    ><i class="fa fa-fw fa-lg fa-globe"></i>
                    matiasgallipoli.com</span
                  >
                  <span class="m-r-10"
                    ><i class="fa fa-fw fa-lg fa-phone-volume"></i>
                    T:016-18192302</span
                  >
                  <span class="m-r-10"
                    ><i class="fa fa-fw fa-lg fa-envelope"></i>
                    rtiemps@gmail.com</span
                  >
                </p>-->
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="section footer-section p-0">
      <div class="container">
        <div class="row mb-4"></div>
        <div class="row pt-5">
          <p class="col-md-8 text-left">
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
            Copyright &copy;
            <script>
              document.write(new Date().getFullYear());
            </script>
            All rights reserved | This template is made with
            <i class="fa fa-heart text-primary" aria-hidden="true"></i> by
            <a href="https://colorlib.com" target="_blank">Colorlib</a>
            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
          </p>

          <p class="col-md-4 text-right social">
            <a href="#"><span class="fa fa-tripadvisor"></span></a>
            <a href="#"><span class="fa fa-facebook"></span></a>
            <a href="#"><span class="fa fa-twitter"></span></a>
            <a href="#"><span class="fa fa-linkedin"></span></a>
            <a href="#"><span class="fa fa-vimeo"></span></a>
          </p>
        </div>
      </div>
    </footer>

    <!-- Modal -->

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/jquery-migrate-3.0.1.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/owl.carousel.min.js"></script>
    <script src="../js/jquery.stellar.min.js"></script>
    <script src="../js/jquery.fancybox.min.js"></script>
    <script src="../js/jquery.easing.1.3.js"></script>

    <script src="../js/aos.js"></script>

    <script src="../js/bootstrap-datepicker.js"></script>
    <script src="../js/jquery.timepicker.min.js"></script>

    <script src="../js/main1.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.24.0/moment.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gasparesganga-jquery-loading-overlay@2.1.7/dist/loadingoverlay.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
  </body>
  <script>
    $(document).ready(() => {
      if (
        sessionStorage.getItem("checkin_date") == null ||
        sessionStorage.getItem("checkin_date") == null ||
        sessionStorage.getItem("room_details") == null ||
        sessionStorage.getItem("guest_details") == null
      )
        window.location = "../index.html";

      let guest_details = JSON.parse(sessionStorage.getItem("guest_details"));

      var today = moment();
      var tomorrow = moment(today).add(1, "days");

      $("#guest_name").html(
        guest_details.first_name + " " + guest_details.last_name
      );
      $("#guest_num").html(guest_details.num_guest);
      $("#guest_address").html(guest_details.address);
      $("#guest_contact").html(guest_details.contact_num);
      $("#guest_email").html(guest_details.email);

      let check_in = new Date(sessionStorage.getItem("checkin_date"));
      let check_out = new Date(sessionStorage.getItem("checkout_date"));

      let timediff = check_out.getTime() - check_in.getTime();
      let nights = timediff / (1000 * 3600 * 24);

      $("#check_in").html(
        moment(sessionStorage.getItem("checkin_date")).format("DD MMMM YYYY")
      );
      $("#check_out").html(
        moment(sessionStorage.getItem("checkout_date")).format("DD MMMM YYYY")
      );
      $("#nights").html(nights);

      let room_details = JSON.parse(sessionStorage.getItem("room_details"));

      let sub_total = 0;
      room_details.map((room) => {
        sub_total += room.new_price;
        $("#invoice").append(
          "<tr>" +
            "<td>" +
            room.roomtype_name +
            "</td>" +
            "<td>PHP " +
            room.new_price / room.num_rooms / nights +
            ".00</td>" +
            "<td>" +
            nights +
            "</td>" +
            "<td>" +
            room.num_rooms +
            "</td>" +
            "<td>PHP " +
            room.new_price +
            ".00</td>" +
            "</tr>"
        );
      });

      let total_amount = sub_total;
      let VAT = total_amount * 0.12;
      let vatable_sales = total_amount - VAT;
      let downpayment = total_amount / 2;

      $("#vatable").html("PHP " + vatable_sales + ".00");
      $("#vat").html("PHP " + VAT + ".00");
      $("#sub_total").html("PHP " + total_amount + ".00");
      $("#downpayment").html("PHP " + downpayment + ".00");
      $("#total_amount").html("PHP " + total_amount + ".00");

      let selected_rooms = [];

      $("#confirm").click(() => {
        $("#confirm").attr("disabled", "disabled");
        $.LoadingOverlay("show", {
          image: "",
          progress: true,
        });
        var count = 0;
        var interval = setInterval(function () {
          if (count >= 100) {
            clearInterval(interval);
            $.LoadingOverlay("hide");
            return;
          }
          count += 20;
          $.LoadingOverlay("progress", count);
        }, 300);

        room_details.map((room) => {
          room.room_ids.map((rooms) => {
            selected_rooms.push(rooms);
          });
        });

        let reservation_id = parseInt(
          Date.now().toString().substring(1, 5) +
            parseInt(Math.random().toString().substring(2, 6))
        );

        let guest_id = parseInt(
          Date.now().toString().substring(2, 6) +
            parseInt(Math.random().toString().substring(3, 7))
        );

        let billing_id = parseInt(
          Date.now().toString().substring(3, 7) +
            parseInt(Math.random().toString().substring(4, 8))
        );

        let new_check_in = moment(check_in).format("YYYY-MM-DD");
        let new_check_out = moment(check_out).format("YYYY-MM-DD");

        $.ajax({
          url: "../php_functions/validate_rooms.php",
          data:
            "selected_rooms=" +
            JSON.stringify(selected_rooms) +
            "&checkin_date=" +
            new_check_in +
            "&checkout_date=" +
            new_check_out,
          type: "POST",
          success: function (response) {
            let res = response;
            if (res == '"1"') {
              if (moment(tomorrow._d).format("YYYY-MM-DD") == new_check_in) {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text:
                      "You have until today 11:59PM to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              } else {
                setTimeout(function () {
                  Swal.fire({
                    icon: "success",
                    title: "Thank You for Booking With Us!",
                    text:
                      "You have 24 Hours to pay your downpayment, Please check your e-mail",
                    footer:
                      "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                    timer: 5000,
                    showCancelButton: false,
                    showConfirmButton: false,
                  });
                }, 2100);
              }

              $.ajax({
                url: "../php_functions/insert_reservation.php",
                data:
                  "guest_id=" +
                  guest_id +
                  "&first_name=" +
                  guest_details.first_name +
                  "&last_name=" +
                  guest_details.last_name +
                  "&gender=" +
                  guest_details.gender +
                  "&contact_number=" +
                  guest_details.contact_num +
                  "&email=" +
                  guest_details.email +
                  "&address=" +
                  guest_details.address +
                  "&city=" +
                  guest_details.city +
                  "&zip_code=" +
                  guest_details.zipcode +
                  "&reservation_id=" +
                  reservation_id +
                  "&billing_id=" +
                  billing_id +
                  "&checkin_date=" +
                  new_check_in +
                  "&num_guest=" +
                  guest_details.num_guest +
                  "&checkout_date=" +
                  new_check_out +
                  "&reservation_type=" +
                  0 +
                  "&status=" +
                  0 +
                  "&room_details=" +
                  JSON.stringify(room_details),
                type: "POST",
                success: function (response) {
                  localStorage.clear();
                },
              });

              setTimeout(() => {
                window.location = "../index.html";
              }, 7200);
            } else {
              setTimeout(function () {
                Swal.fire({
                  icon: "warning",
                  title: "Oops...",
                  text: "Something went wrong!, Booking Unsuccessfull",
                  footer:
                    "<span class='text-info'>You will direct to home page in 5 seconds...</span>",
                  timer: 5000,
                  showCancelButton: false,
                  showConfirmButton: false,
                });
              }, 2100);

              setTimeout(() => {
                window.location = "../index.html";
              }, 8100);
            }
          },
        });
      });
    });
  </script>
</html>
