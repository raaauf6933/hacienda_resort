<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>Hacienda Galea Resort and Events Place | Select Room</title>
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <link rel="icon" href="../images/favicon.ico" type="image/png" />
    <link
      rel="stylesheet"
      type="text/css"
      href="//fonts.googleapis.com/css?family=|Roboto+Sans:400,700|Playfair+Display:400,700"
    />

    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../css/animate.css" />
    <link rel="stylesheet" href="../css/owl.carousel.min.css" />
    <link rel="stylesheet" href="../css/aos.css" />
    <link rel="stylesheet" href="../css/bootstrap-datepicker.css" />
    <link rel="stylesheet" href="../css/jquery.timepicker.css" />
    <link rel="stylesheet" href="../css/fancybox.min.css" />

    <link rel="stylesheet" href="../fonts/ionicons/css/ionicons.min.css" />
    <link
      rel="stylesheet"
      href="../fonts/fontawesome/css/font-awesome.min.css"
    />

    <link rel="stylesheet" href="../css/breadcrumb.css" type="text/css" />

    <!-- Theme Style -->
    <link rel="stylesheet" href="../css/_custom.css" />
    <link rel="stylesheet" href="../css/style.css" />
  </head>
  <body data-spy="scroll" data-target="#templateux-navbar" data-offset="200">
    <nav
      class="navbar navbar-expand-lg navbar-dark pb_navbar pb_scrolled-light scrolled awake"
      id="templateux-navbar"
    >
      <div class="container">
        <img
          style="width: 4em"
          class="img-fluid m-1"
          src="../images/logo1.png"
        />
        <a class="navbar-brand" href="index.html"
          ><span class="text-warning">Hacienda Galea Resort</span><br />and
          Events Place</a
        >
        <div
          class="site-menu-toggle js-site-menu-toggle ml-auto"
          data-aos="fade"
          data-toggle="collapse"
          data-target="#templateux-navbar-nav"
          aria-controls="templateux-navbar-nav"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span></span>
          <span></span>
          <span></span>
        </div>
        <!-- END menu-toggle -->

        <div class="collapse navbar-collapse" id="templateux-navbar-nav">
          <ul class="navbar-nav ml-auto">
            <li class="nav-item">
              <a class="nav-link" href="../index.html">Home</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../rooms.html">Rooms</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../gallery.html">Gallery</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../aboutus.html">About</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" href="../contact.html">Contact</a>
            </li>
            <li class="nav-item cta-btn ml-xl-2 ml-lg-2 ml-md-0 ml-sm-0 ml-0">
              <a class="nav-link" href="../myBooking.html" target="_blank"
                ><span class="pb_rounded-4 px-4 rounded">My Booking</span></a
              >
            </li>
          </ul>
        </div>
      </div>
    </nav>
    <!-- END nav -->
    <!-- END .block-2 -->
    <!-- END section -->
    <!-- END section -->

    <section class="section contact-section" id="section-contact">
      <div class="container">
        <div class="bread">
          <div class="breadcrumb-pagination">
            <div class="completed">
              <span>1</span>
              <p>Select Dates</p>
            </div>
            <div class="active">
              <span>2</span>
              <p>Rooms</p>
            </div>
            <div class="todo">
              <span>3</span>
              <p>Guest Detail</p>
            </div>
            <div class="todo">
              <span>4</span>
              <p>Review</p>
            </div>
            <div class="todo">
              <span>5</span>
              <p>Confirmation</p>
            </div>
          </div>
        </div>

        <div class="row">
          <div id="room_row" class="col-lg-8"></div>
          <div class="col-lg-4">
            <div
              class="card mt-2 bg-light"
              style="width: 20rem"
              id="card-rooms"
            >
              <div class="card-body">
                <h2 class="card-title">Your Stay</h2>
                <div class="row">
                  <div class="col-6">
                    <span><b>Check-In</b></span>
                  </div>
                  <div class="col-6">
                    <span><b>Check-Out</b></span>
                  </div>
                </div>
                <div class="row">
                  <div class="col-6">
                    <span>10:00 AM</span>
                  </div>
                  <div class="col-6">
                    <span>8:00 AM</span>
                  </div>
                </div>
              </div>

              <div class="room_selected">
                <div class="dropdown-divider ml-4 mr-4"></div>
                <table
                  class="table table-borderless table-sm ml-2"
                  id="invoice"
                >
                  <thead>
                    <tr>
                      <th>Room</th>
                      <th>Qty</th>
                      <th>Price</th>
                      <th></th>
                    </tr>
                  </thead>
                  <tbody></tbody>
                </table>
              </div>
              <div class="card-body">
                <div class="dropdown-divider"></div>
                <button class="btn btn-info mr-2" id="continue">
                  Continue
                </button>
                <button
                  class="btn btn-danger ml-2"
                  id="reset"
                  onClick="window.location.reload()"
                >
                  Reset
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <footer class="section footer-section p-0">
      <div class="container">
        <div class="row mb-4"></div>
        <div class="row pt-5">
          <p class="col-md-8 text-left">
            Copyright &copy;
            <script>
              document.write(new Date().getFullYear());
            </script>
            All rights reserved | Hacienda Galea Resort
          </p>
          <p class="col-md-4 text-right social">
            <!-- <a href=""><span class="fa fa-tripadvisor"></span></a> -->
            <a
              href="https://www.facebook.com/haciendagaleabaliuag"
              target="_blank"
              ><span class="fa fa-facebook"></span
            ></a>
            <!-- <a href="#"><span class="fa fa-twitter"></span></a>
            <a href="#"><span class="fa fa-linkedin"></span></a>
            <a href="#"><span class="fa fa-vimeo"></span></a> -->
          </p>
        </div>
      </div>
    </footer>

    <!-- Modal -->

    <script src="../js/jquery-3.3.1.min.js"></script>
    <script src="../js/jquery-migrate-3.0.1.min.js"></script>
    <script src="../js/popper.min.js"></script>
    <script src="../js/bootstrap.min.js"></script>
    <script src="../js/owl.carousel.min.js"></script>
    <script src="../js/jquery.stellar.min.js"></script>
    <script src="../js/jquery.fancybox.min.js"></script>
    <script src="../js/jquery.easing.1.3.js"></script>

    <script src="../js/aos.js"></script>

    <script src="../js/bootstrap-datepicker.js"></script>
    <script src="../js/jquery.timepicker.min.js"></script>

    <script src="../js/main1.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@9"></script>
    <script src="../admin/dist/js/update_expired_noshow.js"></script>
  </body>

  <script>
    if (
      sessionStorage.getItem("checkin_date") == null ||
      sessionStorage.getItem("checkout_date") == null
    )
      window.location = "../index.html";

    let date_from = new Date(sessionStorage.getItem("checkin_date"));
    let date_to = new Date(sessionStorage.getItem("checkout_date"));

    var Difference_In_Time = date_to.getTime() - date_from.getTime();
    var nights = Difference_In_Time / (1000 * 3600 * 24);

    let reqr_roomtype = (function () {
      var tmp = null;
      $.ajax({
        async: false,
        url: "../php_functions/get_roomtype.php",
        type: "POST",
        success: function (data) {
          tmp = data;
        },
      });
      return JSON.parse(tmp);
    })();

    let req_rooms = (function () {
      var tmp = null;
      $.ajax({
        async: false,
        url: "../php_functions/get_rooms.php",
        data:
          "check_in=" +
          sessionStorage.getItem("checkin_date") +
          "&check_out=" +
          sessionStorage.getItem("checkout_date"),
        type: "POST",
        success: function (data) {
          tmp = data;
        },
      });
      return JSON.parse(tmp);
    })();

    reqr_roomtype.map((roomtype) => {
      let counter_rooms = 0;
      req_rooms.map((rooms) => {
        if (rooms.roomtype_id == roomtype.roomtype_id) {
          counter_rooms += 1;
        } else {
        }
      });

      let option = "";

      if (counter_rooms == 0) {
        option = "<option value='0'>No available room</option>";
      } else {
        for (i = 1; counter_rooms >= i; i++) {
          option += "<option value=" + i + ">" + i + "</option>";
        }
      }

      $("#room_row").append(
        $(
          '<div class="room-details-item" id="view' +
            roomtype.roomtype_id +
            '">' +
            '<a  href="../admin/dist/img/room/' +
            roomtype.roomtype_photo +
            '" data-fancybox="images"  data-caption="' +
            roomtype.roomtype_name +
            '"><img src ="../admin/dist/img/room/' +
            roomtype.roomtype_photo +
            '" style="    width: 100%; height: 461px;" alt = ""/></a>' +
            '<div class="rd-text"><div class="rd-title"><h3>' +
            roomtype.roomtype_name +
            '</h3><div class="rdt-right"> <form class="add-room"><div class="row">' +
            '<input value="' +
            roomtype.roomtype_id +
            '" hidden/><input value="' +
            roomtype.roomtype_price +
            '" hidden/><input value="' +
            roomtype.roomtype_name +
            '" hidden/><input value="' +
            roomtype.roomtype_capacity +
            '"hidden/>' +
            '<div class="col-8"> ' +
            '<select class="form-control" id=room' +
            roomtype.roomtype_id +
            ' required><option value="" selected hidden disabled>Select Avail. Rooms</option>' +
            option +
            "</select> <p class='text-center'><em>( " +
            counter_rooms +
            " left)</em></p> </div>" +
            '<div class="col-4"><button class="room' +
            roomtype.roomtype_id +
            ' btn btn-primary" id=room' +
            roomtype.roomtype_id +
            ">ADD</button></div></div> </form>" +
            "</div> " +
            "</div> " +
            "<h2>" +
            roomtype.roomtype_price +
            "Php<span>/ Pernight</span></h2> " +
            "<table> " +
            "<tbody>" +
            "<tr> " +
            '<td class="r-o">Capacity:</td> ' +
            "<td>Max person " +
            roomtype.roomtype_capacity +
            "</td>" +
            " </tr>" +
            "<tr> " +
            '<td class="r-o">Description:</td>' +
            " <td>" +
            roomtype.description +
            "</td>" +
            " </tr>" +
            " </tbody>" +
            " </table>" +
            " </div>" +
            " </div >"
        )
      );
    });

    let selected_array = [];

    //add_selected
    $(".add-room").submit(function (e) {
      e.preventDefault();
      if (e.target[4].value != 0) {
        let roomtype_id = e.target[0].value;
        let roomtype_price = e.target[1].value;
        let roomtype_name = e.target[2].value;
        let roomtype_capacity = e.target[3].value;
        let num_rooms = e.target[4].options.selectedIndex;

        let new_price = roomtype_price * num_rooms * nights;
        let new_capacity = roomtype_capacity * num_rooms;
        let selected_object = {};

        let selected_rooms = [];

        let counter = 1;
        req_rooms.map((rooms) => {
          if (rooms.roomtype_id == roomtype_id && counter <= num_rooms) {
            selected_rooms.push(rooms.room_id);
            counter++;
          }
        });

        selected_object.roomtype_id = roomtype_id;
        selected_object.roomtype_name = roomtype_name;
        selected_object.num_rooms = num_rooms;
        selected_object.new_capacity = new_capacity;
        selected_object.new_price = new_price;
        selected_object.room_ids = selected_rooms;

        selected_array.push(selected_object);

        $("#room" + roomtype_id).attr("disabled", "disabled");
        $(".room" + roomtype_id).attr("disabled", "disabled");

        $("#invoice > tbody:last-child").append(
          "<tr id='" +
            roomtype_id +
            "'>" +
            "<th>" +
            roomtype_name +
            "</th>" +
            "<td>" +
            num_rooms +
            "</td>" +
            "<td>PHP " +
            new_price +
            ".00</td>" +
            "<td>" +
            '<button class="btn' +
            roomtype_id +
            ' btn btn-default">' +
            '<i class="fa fa-times"></i>' +
            "</button>" +
            "</td>" +
            "</tr>"
        );
        $(".btn" + roomtype_id).attr(
          "onclick",
          "deleteselected(" + roomtype_id + ")"
        );
      } else {
        Swal.fire({
          icon: "info",
          title: "Oops...",
          text:
            "This type of room has no available room, Try another booking dates",
        });
      }
    });

    deleteselected = (e) => {
      let room_id = e;
      let new_object = {};

      selected_array = selected_array.filter(check_selected);

      function check_selected(item, index, array) {
        if (item.roomtype_id != room_id) {
          return item;
        }
      }
      //console.log(room_id[0])
      console.log(selected_array);
      $("#" + room_id).remove();
      $("#room" + room_id).removeAttr("disabled", "disabled");
      $(".room" + room_id).removeAttr("disabled", "disabled");
    };

    //continue
    $("#continue").click((e) => {
      console.log(selected_array);
      if (selected_array.length != 0) {
        sessionStorage.setItem("room_details", JSON.stringify(selected_array));

        window.location = "guest-details.html";
      } else {
        Swal.fire({
          icon: "warning",
          title: "You forgot something?",
          text: "Please select room first!",
        });
      }
    });
  </script>
</html>
